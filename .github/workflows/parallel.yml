# name: test-automation

# on:
#   workflow_dispatch:
#     inputs:
#       testing-type:
#         type: choice
#         description: "Select the testing type: "
#         options:
#           - Functional
#           - Visual
#         required: true
#       browser-type:
#         type: choice
#         description: "Select the browser: "
#         options:
#           - chrome
#           - firefox
#           - edge
#         required: true
#       env-type:
#         type: choice
#         description: "Select the environment: "
#         options:
#           - prod
#           - stage
#           - dev
#         required: true

# jobs:
#   split:
#     uses: ./.github/workflows/reusable.yml
#     with:
#       n: ${{ github.event.inputs['testing-type'] == 'Visual' && 1 || 10 }} # Set n to 1 for Visual, otherwise 10
#       marge: true
#       working-directory: "test-automation"
#       command: ${{ github.event.inputs['testing-type'] == 'Visual' && 'npx percy exec -- cypress run --spec cypress/e2e/Visual/*.cy.js --env environment=prod' || format('npx cypress run --headed --spec cypress/e2e/{0}/*.cy.js --env environment={1} --browser {2}', github.event.inputs['testing-type'], github.event.inputs['env-type'], github.event.inputs['browser-type']) }}

#     secrets:
#       CYPRESS_username: ${{secrets.CYPRESS_USERNAME}}
#       CYPRESS_password: ${{secrets.CYPRESS_PASSWORD}}
#       PERCY_TOKEN: ${{secrets.PERCY_TOKEN}}

name: test-automation

on:
  workflow_dispatch:
    inputs:
      website:
        type: choice
        description: "Select the website:"
        options:
          - ACPH
          - ICPH
        required: true

      testing-type:
        type: choice
        description: "Select the testing type:"
        options:
          - Functional
          - Visual
        required: true

      env-type:
        type: choice
        description: "Select the environment:"
        options:
          - prod
          - stage
          - dev
        required: true

jobs:
  chrome-desktop:
    uses: ./.github/workflows/reusable.yml
    with:
      n: ${{ github.event.inputs.testing-type == 'Visual' && 1 || 7 }}
      browser: chrome
      marge: true
      working-directory: "test-automation"
      command: >-
        ${{ github.event.inputs.testing-type == 'Visual' && format(
          'npx percy exec -- cypress run --spec cypress/e2e/Visual/{0}/*.cy.js --browser chrome --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) || format(
          'npx cypress run --headed --spec cypress/e2e/Functional/{0}/*.cy.js --browser chrome --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) }}
    secrets: inherit
    runs-on: macos-latest

  firefox-desktop:
    uses: ./.github/workflows/reusable.yml
    with:
      n: ${{ github.event.inputs.testing-type == 'Visual' && 1 || 7 }}
      browser: firefox
      marge: true
      working-directory: "test-automation"
      command: >-
        ${{ github.event.inputs.testing-type == 'Visual' && format(
          'npx percy exec -- cypress run --spec cypress/e2e/Visual/{0}/*.cy.js --browser firefox --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) || format(
          'npx cypress run --headed --spec cypress/e2e/Functional/{0}/*.cy.js --browser firefox --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) }}
    secrets: inherit
    runs-on: macos-latest

  edge-desktop:
    uses: ./.github/workflows/reusable.yml
    with:
      n: ${{ github.event.inputs.testing-type == 'Visual' && 1 || 7 }}
      browser: edge
      marge: true
      working-directory: "test-automation"
      command: >-
        ${{ github.event.inputs.testing-type == 'Visual' && format(
          'npx percy exec -- cypress run --spec cypress/e2e/Visual/{0}/*.cy.js --browser edge --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) || format(
          'npx cypress run --headed --spec cypress/e2e/Functional/{0}/*.cy.js --browser edge --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) }}
    secrets: inherit
    runs-on: windows-latest

  iphone-chrome:
    uses: ./.github/workflows/reusable.yml
    with:
      n: ${{ github.event.inputs.testing-type == 'Visual' && 1 || 7 }}
      browser: chrome
      marge: false
      working-directory: "test-automation"
      command: >-
        ${{ github.event.inputs.testing-type == 'Visual' && format(
          'npx percy exec -- cypress run --spec cypress/e2e/Visual/{0}/*.cy.js --browser edge --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) || format(
          'npx cypress run --headed --spec cypress/e2e/Functional/{0}/*.cy.js --browser edge --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) }}
    secrets: inherit
    runs-on: macos-latest

  android-chrome:
    uses: ./.github/workflows/reusable.yml
    with:
      n: ${{ github.event.inputs.testing-type == 'Visual' && 1 || 7 }}
      browser: chrome
      marge: false
      working-directory: "test-automation"
      command: >-
        ${{ github.event.inputs.testing-type == 'Visual' && format(
          'npx percy exec -- cypress run --spec cypress/e2e/Visual/{0}/*.cy.js --browser edge --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) || format(
          'npx cypress run --headed --spec cypress/e2e/Functional/{0}/*.cy.js --browser edge --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) }}
    secrets: inherit
    runs-on: macos-latest

  ipad-chrome:
    uses: ./.github/workflows/reusable.yml
    with:
      n: ${{ github.event.inputs.testing-type == 'Visual' && 1 || 7 }}
      browser: chrome
      marge: false
      working-directory: "test-automation"
      command: >-
        ${{ github.event.inputs.testing-type == 'Visual' && format(
          'npx percy exec -- cypress run --spec cypress/e2e/Visual/{0}/*.cy.js --browser edge --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) || format(
          'npx cypress run --headed --spec cypress/e2e/Functional/{0}/*.cy.js --browser edge --env environment={1},viewportWidth=1280,viewportHeight=720 --config-file cypress.{2}.config.js',
          github.event.inputs.website,
          github.event.inputs.env-type,
          github.event.inputs.website.toLowerCase()
        ) }}
    secrets: inherit
    runs-on: macos-latest

  tab-chrome:
    uses: ./.github/workflows/reusable.yml
    with:
      n: ${{ github.event.inputs.testing-type == 'Visual' && 1 || 7 }}
      browser: chrome
      marge: false
      working-directory: "test-automation"
      command: format(
        'npx cypress run --headed --spec cypress/e2e/Functional/{0}/*.cy.js --browser chrome --env environment={1},viewportWidth=768,viewportHeight=1024 --config-file cypress.{2}.config.js',
        github.event.inputs.website,
        github.event.inputs.env-type,
        github.event.inputs.website.toLowerCase()
       )
    secrets: inherit
    runs-on: macos-latest
