name: test-automation

on:
  workflow_dispatch:
    inputs:
      website:
        type: choice
        description: "Select the website:"
        options:
          - ACPH
          - ICPH
        required: true

      testing-type:
        type: choice
        description: "Select the testing type:"
        options:
          - Functional
          - Visual
        required: true

      browser-type:
        type: choice
        description: "Select the browser:"
        options:
          - chrome
          - firefox
          - edge
        required: true

      env-type:
        type: choice
        description: "Select the environment:"
        options:
          - prod
          - stage
          - dev
        required: true

jobs:
  split:
    uses: ./.github/workflows/reusable.yml
    with:
      n: ${{ github.event.inputs['testing-type'] == 'Visual' && 1 || 10 }} # Set n to 1 for Visual, otherwise 10
      marge: true
      working-directory: "test-automation"
      command: ${{ format(
        'npx cypress run --headed --spec cypress/e2e/{0}/*.cy.js --env environment={1} --browser {2} --config-file {3}',
        github.event.inputs['testing-type'],
        github.event.inputs['env-type'],
        github.event.inputs['browser-type'],
        github.event.inputs['website'] == 'ACPH' && 'cypress.acph.config.js' || 'cypress.icph.config.js'
       ) }}
    secrets:
      CYPRESS_username: ${{ secrets.CYPRESS_USERNAME }}
      CYPRESS_password: ${{ secrets.CYPRESS_PASSWORD }}
      PERCY_TOKEN: ${{ secrets.PERCY_TOKEN }}
